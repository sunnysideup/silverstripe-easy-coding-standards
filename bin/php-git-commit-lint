#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
WORKING_DIR=$(pwd)
: ${dir:=app/src} # dir will take on the value "app/src" if not overridden
: ${configFile:=app/_config.php} # configFile will take on the value "app/_config.php" if not overridden
: ${logFile:=LINTING_ERRORS.txt} # configFile will take on the value "app/_config.php" if not overridden
: ${level:=4} # level will take on the value "4" if not overridden
if [ -z "$(git status --porcelain)" ]; then
    echo "# Working directory clean"
    > $WORKING_DIR/$logFile
    echo "# run linter"
    dir=$WORKING_DIR/$dir configFile=$WORKING_DIR/$configFile $SCRIPT_DIR/php-lint >> $WORKING_DIR/$logFile
    echo "# run bugfix"
    level=$level $SCRIPT_DIR/php-bugfix >> $WORKING_DIR/$logFile
    echo "# adding files"
    git add $WORKING_DIR/$dir
    git add $WORKING_DIR/$configFile
    git add $WORKING_DIR/$logFile
    echo "# committing files"
    git commit $WORKING_DIR/$dir -m "PATCH: automated cleanup of src dir"
    git commit $WORKING_DIR/$configFile -m "PATCH: automated cleanup of config file"
    git commit $WORKING_DIR/$logFile -m "PATCH: adding log file"
    echo "# pushing files"
    git push
    echo "
---------------------------
DONE
---------------------------
    "
else
    echo "
---------------------------
Sorry, can not run, there are uncommitted changes
---------------------------
    "
fi
