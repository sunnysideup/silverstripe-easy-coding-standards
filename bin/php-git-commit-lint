#!/bin/bash
: ${dir:=app/src} # dir will take on the value "app/src" if not overridden
: ${configFile:=app/_config.php} # configFile will take on the value "app/_config.php" if not overridden
: ${logFile:=LINTING_ERRORS.txt} # configFile will take on the value "app/_config.php" if not overridden

if [ -z "$(git status --porcelain)" ]; then
    echo "# Working directory clean"
    > $logFile
    dir=$dir vendor/bin/php-lint >> $logFile
    configFile=$configFile vendor/bin/php-bugfix >> $logFile
    git add ./$logFile
    git add ./ecs.yml
    git add ./phpstan.neon
    git add $configFile
    git commit app/src -m "PATCH: automated cleanup: src dir"
    git commit $configFile -m "PATCH: automated cleanup: config file"
    git commit ./$logFile -m "PATCH: adding log file"
    git commit ./ecs.yml -m "PATCH: adding esc.yml file"
    git commit ./phpstan.neon -m "PATCH: adding phpstan.neon file"
    git push
    echo "
---------------------------
DONE
---------------------------
    "
else
    echo "
---------------------------
Sorry, can not run, there are uncommitted changes
---------------------------
    "
fi
