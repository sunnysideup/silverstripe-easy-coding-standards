#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
WORKING_DIR=$(pwd)
: ${dir:=app/src}
: ${also:=app/_config.php}
: ${logFile:=LINTING_ERRORS.txt} #
: ${message:=LINTING}

echo "# changing directory to $dir"
cd $dir
if [ -z "$(git status --porcelain)" ]; then
    cd -
    echo "# Working directory clean"
    > $WORKING_DIR/$logFile

    echo "# run linter"
    dir=$dir also=$also $SCRIPT_DIR/php-sslint-ecs >> $WORKING_DIR/$logFile

    echo "# run bugfix"
    dir=$dir also=$also $SCRIPT_DIR/php-sslint-stan >> $WORKING_DIR/$logFile

    echo "# commit and push"
    message=$message dir=$dir also=$also $SCRIPT_DIR/php-sslint-gitpush

    echo "
---------------------------
DONE
---------------------------
    "
else
    cd -
    echo "
---------------------------
Sorry, can not run, there are uncommitted changes
---------------------------
    "
fi
