#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
WORKING_DIR=$(pwd)
: ${dir:=app/src} # dir will take on the value "app/src" if not overridden
: ${configFile:=app/_config.php} # configFile will take on the value "app/_config.php" if not overridden
: ${logFile:=LINTING_ERRORS.txt} # configFile will take on the value "app/_config.php" if not overridden
: ${level:=4} # level will take on the value "4" if not overridden
: ${message:=LINTING} # level will take on the value "4" if not overridden
cd $dir
if [ -z "$(git status --porcelain)" ]; then
    cd -
    echo "# Working directory clean"
    > $WORKING_DIR/$logFile

    echo "# run linter"
    dir=$dir configFile=$configFile $SCRIPT_DIR/php-sslint-ecs >> $WORKING_DIR/$logFile

    echo "# run bugfix"
    dir=$dir configFile=$configFile level=$level $SCRIPT_DIR/php-sslint-stan >> $WORKING_DIR/$logFile

    echo "# commit and push"
    message=$message dir=$dir configFile=$configFile $SCRIPT_DIR/php-sslint-gitpush

    echo "
---------------------------
DONE
---------------------------
    "
else
    cd -
    echo "
---------------------------
Sorry, can not run, there are uncommitted changes
---------------------------
    "
fi
