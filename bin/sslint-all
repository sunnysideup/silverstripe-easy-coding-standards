#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
WORKING_DIR=$(pwd)
if [ "$1" != "" ]; then
    dir=$1;
else
    dir='app/src'
fi

also='app/_config.php'
message='PATCH: linting'

while getopts a:m: flag
do
    case "${flag}" in
        a) also=${OPTARG};;
        m) message=${OPTARG};;
    esac
done
echo "
---------------------------"
echo "# changing directory to $dir and committing and pushing"
cd $dir
git add . -A
git commit . -m "WIP"
echo "
---------------------------"

if [ -z "$(git status --porcelain)" ]; then
    cd -

    echo "# run linter"
    $SCRIPT_DIR/sslint-ecs -d $dir -a $also

    echo "# run bugfix"
    $SCRIPT_DIR/sslint-stan -d $dir -a $also

    echo "# commit and push"
    $SCRIPT_DIR/sslint-gitpush -m "$message" -d $dir

    echo "
---------------------------
DONE
---------------------------
    "
else
    cd -
    echo "
---------------------------
Sorry, can not run, there are uncommitted changes
---------------------------
    "
fi
