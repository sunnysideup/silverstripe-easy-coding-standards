#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"
WORKING_DIR=$(pwd)


help_and_exit() {
    echo "---------------------------------";
    echo "  Available settings:";
    echo "  -a (also lint)";
    echo "  -m (commit message)";
    echo "---------------------------------";
    echo "  Example usage:"
    echo "  sslint-all foo/bar -a app_more/_config.php ";
    echo "---------------------------------";
    echo ""
    echo ""
    exit;
}

message='PATCH: linting'
also='app/_config.php'
dir='app/src'
while (( $# )); do
  case $1 in
    -a|--also)      also=$2;shift ;;
    -m|--message)   message=$2;shift ;;
    -*)             printf 'Unknown option: %q\n\n' "$1";
                    help_and_exit 1 ;;
    *) dir=$1;;
  esac
  shift
done



echo "---------------------------"
echo "# changing directory to $dir and committing and pushing"
echo "---------------------------"
cd $dir
git add . -A
git commit . -m "WIP"
echo "---------------------------"

if [ -z "$(git status --porcelain)" ]; then
    cd -

    echo "# run linter"
    $SCRIPT_DIR/sslint-ecs -a $also $dir

    echo "# run bugfix"
    $SCRIPT_DIR/sslint-stan -a $also $dir

    echo "# commit and push"
    $SCRIPT_DIR/sslint-gitpush  -m "$message" $dir

    echo "
---------------------------
DONE
---------------------------
    "
else
    cd -
    echo "
---------------------------
Sorry, can not run, there are uncommitted changes
---------------------------
    "
fi
