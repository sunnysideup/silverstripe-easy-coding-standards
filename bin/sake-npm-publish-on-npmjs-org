#!/bin/bash

############################################ BASICS
SCRIPT_DIR="$COMPOSER_RUNTIME_BIN_DIR"
WORKING_DIR=$(pwd)
source $SCRIPT_DIR/sake-self-methods

# : ${stanConfig:=$SCRIPT_DIR/../sunnysideup/easy-coding-standards/phpstan.neon}

############################################ DIR
dir="./"

############################################ SETTINGS
webpackDir='themes/sswebpack_engine_only/'
themeDir=''
help='no'
while (($#)); do
    case $1 in
    -w | --webpack-dir)
        webpackDir=$2
        shift
        ;;
    -t | --theme-dir)
        themeDir=$2
        shift
        ;;
    -h | --help)
        help='yes'
        shift
        ;;
    -*)
        printf 'Unknown option: %q\n\n' "$1"
        help='yes'
        ;;
    *) dir=$1 ;;
    esac
    shift
done

help_and_exit() {
    ECHOHEAD "NPM Publish on npmjs.org"

    ECHOHEAD "Current settings:"

    ECHOHEAD "Available settings:"
    echonice "-h, --help                    show help information"

    ECHOHEAD "Example usage:"
    echonice "sake-npm-publish-on-npmjs-org"

    echofunctions
    exit
}

############################################ HELP ONLY
if [[ "$help" == "yes" ]]; then
    help_and_exit
fi

############################################ CODE

echonice "committing and pushing changes to git..."

sake-git-commit-and-push .


echonice "Checking if we are logged in to npmjs.org..."
if ! npm whoami > /dev/null 2>&1; then
  npm login
else
  echo "Already logged in as $(npm whoami)"
fi


echonice "Bumping version number..."
npm version patch

echonice "Bumping version to $(npm version | tail -n 1)"
echonice "Publishing to npmjs.org..."

npm publish --access public
sake-git-commit-and-push -m "MNT: pushing to npmjs.org"

echoend
